{% load markdown_deux_tags %}

<article class="post" id="post-{{ post.id }}">
	<header class="post-header">
		{% if post.gitHub %}
			<h1><img src="http://octodex.github.com/images/original.png" width="30" height="30" style="margin-right:10px;"><a href="{{ post.source }}">{{ post.title }}</a></h1>
		{% else %}
			<h1><a href="{% url 'post' post_id=post.id %}">{{ post.title }}</a></h1>
		{% endif %}
		<p class="post-meta">
			Posted by
			<a href="{% url 'profile_author' username=post.author.user.username %}" title="{{ post.author.displayName }}" class="author-link">
				{{ post.author.displayName }}
			</a>
			on {{ post.pubDate|date:"D, M d, Y \a\t H:i" }}

			{% if post.author == user.author %}
				<span class="post-actions"><a href="{% url 'post' post_id=post.id %}">Delete</a></span>
			{% endif %}
		</p>
	</header>
	<section class="post-body">
		{% if full %}
			{% if post.contentType == 'text/plain' %}
			    {{ post.content|escape|linebreaks }}
			{% elif post.contentType == 'text/html' %}
				{{ post.content|safe }}
			{% elif post.contentType == 'text/markdown' %}
				{{ post.content|markdown }}
			{% endif %}
		{% else %}
			<p>
				{{ post.description|escape }}

				{% if post.gitHub %}
				<a href="{{ post.source }}">Read more</a>
				{% else %}
				<a href="{% url 'post' post_id=post.id %}">Read more</a>
				{% endif %}
			</p>
		{% endif %}

		{% if post.image %}
			<div class="post-image">
				<a href="{{ post.image.url }}">
					<img src="{{ post.image.url }}" alt="{{ post.image.name }}" />
				</a>
			</div>
		{% endif %}
	</section>
	<footer class="post-footer">

		{% if not post.gitHub %}

		<h2 class="sr-only">Comments</h2>
		
		{% if post.comment_set.all %}
			<div class="comment">
			{% for comment in post.comment_set.all %}
				<div class="comment">
					<p class="comment-meta"><a href="{% url 'profile_author' username=post.author.user.username %}" title="{{ post.author.displayName }}" class="author-link">{{ comment.author.displayName }}</a> said on {{ comment.pubDate|date:"D, M d, Y \a\t H:i" }}:</p>
					<div class="comment-body">
						{{ comment.comment|escape|linebreaks }}
					</div>
				</div>
			{% endfor %}
			</div>
		{% endif %}

		<form class="form-horizontal" role="form" action="{% url 'post_comment' post_id=post.id %}" method="post">
			{% csrf_token %}
			<div class="form-group row">
				<div class="col-sm-10">
					<textarea class="form-control" id="post-{{ post.id }}-comment" name="comment" placeholder="Your comment goes here..."></textarea>
				</div>
				<div class="col-sm-2">
					<button type="submit" class="btn btn-default">Post</button>
				</div>
			</div>
		</form>

		{% endif %}
	</footer>
</article>