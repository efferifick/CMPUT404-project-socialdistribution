{% extends "layout.html" %}

{% block title %}Timeline{% endblock %}

{% block content %}
	<h1 class="sr-only">Timeline</h1>

	<div class="well">
		<form role="form" action="#newpost" method="post">
			{% csrf_token %}
			<h2>Do you want to say something?</h2>
			<div class="form-group">
				<label for="newpost-title" class="sr-only">Title</label>
				<input type="text" class="form-control" id="newpost-title" name="title" placeholder="Title" maxlength="128" />
			</div>
			<div class="form-group">
				<label for="newpost-description" class="sr-only">Description</label>
				<input type="text" class="form-control" id="newpost-description" name="description" placeholder="Description" maxlength="148" />
			</div>
			<div class="form-group">
				<label for="newpost-body" class="sr-only">Body</label>
				<textarea class="form-control" id="newpost-body" name="body" placeholder="Body" maxlength="5000"></textarea>
			</div>
			<div class="form-group">
			    <label for="newpost-file" class="sr-only">File input</label>
			    <input type="file" id="newpost-file" name="image" />
			    <p class="help-block">You can attach an image to your post.</p>
		  	</div>
		  	<div class="form-group">
		  		<button type="submit" class="btn btn-default">Post</button>
		  	</div>
		</form>
	</div>

	<div id="posts">
		<h2>Stream</h2>
		{% for post in posts %}
			<article class="post well" id="post-{{ post.id }}">
				<header class="post-header">
					<h1><a href="#post-{{ post.id }}">{{ post.title }}</a></h1>
				</header>
				<section class="post-body">
					{% if post.contentType == 'text/plain' %}
					    {{ post.description|safe }}
					{% elif post.contentType == 'text/html' %}
						{{ post.description|safe }}
					{% elif post.contentType == 'text/markdown' %}
						{{ post.description|safe }}
					{% endif %}
					<p><a href="#post-{{ post.id }}">Read more</a></p>
				</section>
				<footer class="post-footer">
					<h2 class="sr-only">Comments</h2>
					
					{% if post.comment_set.all %}
						<div class="comment">
						{% for comment in post.comment_set.all %}
							<div class="comment">
								<div class="comment-body">
									<p>{{ comment.comment }}</p>
								</div>
								<div class="comment-meta">
									<p>Posted by {{ comment.author.displayname }} on {{ comment.pubDate|date:"D, M d, Y" }}</p>
								</div>
							</div>
						{% endfor %}
						</div>
					{% endif %}

					<form class="form-horizontal" role="form" action="#post-{{ post.id }}" method="post">
						{% csrf_token %}
						<div class="form-group row">
							<div class="col-sm-10">
								<textarea class="form-control" id="post-{{ post.id }}-comment" name="comment" placeholder="Your comment goes here..."></textarea>
							</div>
							<div class="col-sm-2">
								<button type="submit" class="btn btn-default">Post</button>
							</div>
						</div>
					</form>
				</footer>
			</article>
		{% empty %}
			<p class="bg-warning">Oops, no posts on your stream just yet.</p>
		{% endfor %}
	</div>

{% endblock %}